import{aZ as Q,aa as k,u as z,i as G,cr as Y,r as q,cy as H,ck as U,j as e,P as r,aB as Z,cp as _,a1 as J,eA as K,c0 as c,eB as f,S as x,eC as W,es as X,et as v,aQ as $,n as ee,ch as te,ci as se,d as ae,eD as ie}from"./strapi-B6GNPAXK.js";import{a as ne,F as C}from"./Input-hScqTWvW-DsC-3KYA.js";import"./usePrev-BJk2lXYH-GH47i3Qc.js";import"./objects-D2z-IJgu-C1ccNwWz.js";import"./ComponentIcon-BZcTc4rj-DnzPPCnj.js";import"./getEmptyImage-CjqolaH3.js";const oe=t=>q.useEffect(t,re),re=[],ce=()=>{const t=Q(),[{query:{status:a}},i]=k({status:"draft"}),{formatMessage:n}=z(),{toggleNotification:o}=G(),d=Y(),{document:j,meta:u,isLoading:I,schema:l,components:b,collectionType:y,id:S,model:L,hasError:A,getTitle:P,getInitialFormValues:R}=d,m=l?.options?.draftAndPublish??!1;oe(()=>{t?.state&&"error"in t.state&&o({type:"danger",message:t.state.error,timeout:5e3})});const V=H("EditViewPage",s=>s.isLoading),g=!S&&!(y===ie),{isLoading:B,edit:{layout:E,settings:{mainField:T}}}=U(L),{isLazyLoading:F}=ne([]),M=V||I||B||F,h=R(g);if(M&&!j?.documentId)return e.jsx(r.Loading,{});if(!h||A)return e.jsx(r.Error,{});const N=s=>{(s==="published"||s==="draft")&&i({status:s},"push",!0)},w=(s,p)=>v(l?.attributes,b,{status:a,...p}).validateSync(s,{abortEarly:!1});return e.jsxs(Z,{paddingLeft:10,paddingRight:10,children:[e.jsx(r.Title,{children:P(T)}),e.jsx(_,{initialDocument:{documentId:S,model:L,collectionType:y},children:e.jsx(J,{disabled:m&&a==="published",initialValues:h,method:g?"POST":"PUT",validate:(s,p)=>v(l?.attributes,b,{status:a,...p}).validate(s,{abortEarly:!1}),initialErrors:t?.state?.forceValidation?w(h,{}):{},children:({resetForm:s})=>e.jsxs(e.Fragment,{children:[e.jsx(K,{isCreating:g,status:m?de(j,u):void 0,title:P(T)}),e.jsxs(c.Root,{variant:"simple",value:a,onValueChange:N,children:[e.jsx(c.List,{"aria-label":n({id:f("containers.edit.tabs.label"),defaultMessage:"Document status"}),children:m?e.jsxs(e.Fragment,{children:[e.jsx(D,{value:"draft",children:n({id:f("containers.edit.tabs.draft"),defaultMessage:"draft"})}),e.jsx(D,{disabled:!u||u.availableStatus.length===0,value:"published",children:n({id:f("containers.edit.tabs.published"),defaultMessage:"published"})})]}):null}),e.jsxs(x.Root,{paddingTop:8,gap:4,children:[e.jsxs(x.Item,{col:9,s:12,direction:"column",alignItems:"stretch",children:[e.jsx(c.Content,{value:"draft",children:e.jsx(C,{layout:E,document:d})}),e.jsx(c.Content,{value:"published",children:e.jsx(C,{layout:E,document:d})})]}),e.jsx(x.Item,{col:3,s:12,direction:"column",alignItems:"stretch",children:e.jsx(W,{})})]})]}),e.jsx(X,{onProceed:s})]})})})]})},D=ae(c.Trigger)`
  text-transform: uppercase;
`,de=(t,a)=>{const i=t?.status,n=a?.availableStatus??[];return i?i==="draft"&&n.find(o=>o.publishedAt!==null)?"published":i:"draft"},xe=()=>{const{slug:t=""}=$(),{permissions:a=[],isLoading:i,error:n}=ee(te.map(o=>({action:o,subject:t})));return i?e.jsx(r.Loading,{}):n||!t?e.jsx(r.Error,{}):e.jsx(r.Protect,{permissions:a,children:({permissions:o})=>e.jsx(se,{permissions:o,children:e.jsx(ce,{})})})};export{ce as EditViewPage,xe as ProtectedEditViewPage,de as getDocumentStatus};
