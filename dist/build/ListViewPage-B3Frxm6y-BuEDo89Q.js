import{h as _,a5 as ue,u as k,i as pe,l as me,eB as P,cr as Q,ck as ee,r as C,eE as ge,aa as D,cm as fe,eF as he,a_ as U,cy as xe,bO as je,eG as ye,j as e,P as w,aV as be,L as q,aI as Ce,ev as Se,F as v,ac as b,cx as Le,T as S,cv as G,eH as Te,ae as V,aQ as Ie,n as te,ch as Me,ci as Re,d as J,U as Fe,ay as Ae,aH as Ee,bB as ke,eI as we,eJ as se,af as ne,cl as ve,m as ae,eK as Pe,ab as H,eL as W,I as Oe,e6 as Be,e as De,aF as $e,dz as He,eM as Ue,eN as Ne,eO as _e,ax as K,ai as Ve,aj as We,ak as ze,eP as qe,bp as Qe,be as Ge,eQ as z,ah as Je,eR as Ke,eS as M,eT as Ye,_ as Ze,al as Xe,eU as ie}from"./strapi-B6GNPAXK.js";import{u as re,a as et,g as le,b as tt,p as Y}from"./usePrev-BJk2lXYH-GH47i3Qc.js";import{u as st}from"./hooks-DMvik5y_-DdGO7c-Q.js";const Z=["json","component","media","richtext","dynamiczone","password","blocks"],nt=["createdAt","updatedAt"],at=[...se,"strapi_assignee"],it=({disabled:t,schema:n})=>{const{attributes:s,uid:a,options:l}=n,{formatMessage:o,locale:x}=k(),{trackUsage:d}=_(),r=ke("FiltersImpl",g=>g.permissions),[{query:f}]=D(),{schemas:m}=we(),L=C.useMemo(()=>r.filter(g=>g.action==="admin::users.read"&&g.subject===null).length>0,[r]),T=(f?.filters?.$and??[]).reduce((g,F)=>{const[y,h]=Object.entries(F)[0];if(typeof h.id!="object")return g;const i=h.id.$eq||h.id.$ne;return i&&at.includes(y)&&!g.includes(i)&&g.push(i),g},[]),{data:j,isLoading:u}=ne({filters:{id:{$in:T}}},{skip:T.length===0||!L}),{users:p=[]}=j??{},{metadata:R}=ve(a,{selectFromResult:({data:g})=>({metadata:g?.contentType.metadatas??{}})}),B=ae(x,{sensitivity:"base"}),O=C.useMemo(()=>{const[{properties:{fields:g=[]}={fields:[]}}]=r.filter(y=>y.action==="plugin::content-manager.explorer.read"&&y.subject===a);return["id",...g.filter(y=>{const h=s[y]??{};return h.type&&!Z.includes(h.type)}),...nt,...L?se:[]].map(y=>{const h=s[y];if(Z.includes(h.type))return null;const{mainField:i="",label:A}=R[y].list;let c={name:y,label:A??"",mainField:Pe(h,i,{schemas:m,components:{}}),type:h.type};return h.type==="relation"&&"target"in h&&h.target==="admin::user"&&(c={...c,input:rt,options:p.map(E=>({label:G(E),value:E.id.toString()})),operators:[{label:o({id:"components.FilterOptions.FILTER_TYPES.$eq",defaultMessage:"is"}),value:"$eq"},{label:o({id:"components.FilterOptions.FILTER_TYPES.$ne",defaultMessage:"is not"}),value:"$ne"}],mainField:{name:"id",type:"integer"}}),h.type==="enumeration"&&(c={...c,options:h.enum.map(E=>({label:E,value:E}))}),c}).filter(Boolean).toSorted((y,h)=>B.compare(y.label,h.label))},[r,L,a,s,R,m,p,o,B]),I=g=>{g&&d("willFilterEntries")},$=g=>{const F=s[g.name];F&&d("didFilterEntries",{useRelation:F.type==="relation"})};return e.jsxs(H.Root,{disabled:t,options:O,onOpenChange:I,onChange:$,children:[e.jsx(H.Trigger,{}),e.jsx(H.Popover,{}),e.jsx(H.List,{})]})},rt=({name:t})=>{const[n,s]=C.useState(10),[a,l]=C.useState(""),{formatMessage:o}=k(),x=et(a,300),{data:d,isLoading:r}=ne({pageSize:n,_q:x}),f=Ve(t),m=p=>{p||s(10)},{users:L=[],pagination:T}=d??{},{pageCount:j=1,page:u=1}=T??{};return e.jsx(We,{value:f.value,"aria-label":o({id:"content-manager.components.Filters.usersSelect.label",defaultMessage:"Search and select a user to filter"}),onOpenChange:m,onChange:p=>f.onChange(t,p),loading:r,onLoadMore:()=>s(n+10),hasMoreItems:u<j,onInputChange:p=>{l(p.currentTarget.value)},children:L.map(p=>e.jsx(ze,{value:p.id.toString(),children:G(p)},p.id))})},N=({type:t,value:n})=>{const{formatDate:s,formatTime:a,formatNumber:l}=k();let o=n;if(t==="date"&&(o=s(Je(n),{dateStyle:"full"})),t==="datetime"&&(o=s(n,{dateStyle:"full",timeStyle:"short"})),t==="time"){const[x,d,r]=n.split(":"),f=new Date;f.setHours(x),f.setMinutes(d),f.setSeconds(r),o=a(f,{timeStyle:"short"})}return["float","decimal"].includes(t)&&(o=l(n,{maximumFractionDigits:20})),["integer","biginteger"].includes(t)&&(o=l(n,{maximumFractionDigits:0})),Ke(o)},lt=({content:t,mainField:n})=>n?e.jsx(K,{label:t[n.name],children:e.jsx(S,{maxWidth:"25rem",textColor:"neutral800",ellipsis:!0,children:e.jsx(N,{type:n.type,value:t[n.name]})})}):null,ot=({content:t,mainField:n})=>{const{formatMessage:s}=k();return n?e.jsxs(M.Root,{children:[e.jsxs(M.Trigger,{onClick:a=>a.stopPropagation(),children:[e.jsx(Ye,{children:t.length}),s({id:"content-manager.containers.list.items",defaultMessage:"{number, plural, =0 {items} one {item} other {items}}"},{number:t.length})]}),e.jsx(M.Content,{children:t.map(a=>e.jsx(M.Item,{disabled:!0,children:e.jsx(S,{maxWidth:"50rem",ellipsis:!0,children:e.jsx(N,{type:n.type,value:a[n.name]})})},a.id))})]}):null},ct=t=>t&&t[0]==="."?t.substring(1):t,oe=({url:t,mime:n,alternativeText:s,name:a,ext:l,formats:o})=>{const x=Y(t);if(n.includes("image")){const f=o?.thumbnail?.url,m=Y(f)||x;return e.jsx(ie.Item,{src:m,alt:s||a,fallback:s||a,preview:!0})}const d=ct(l),r=a.length>100?`${a.substring(0,100)}...`:a;return e.jsx(K,{description:r,children:e.jsx(ce,{children:d})})},ce=({children:t})=>e.jsx(v,{tag:"span",position:"relative",borderRadius:"50%",width:"26px",height:"26px",borderColor:"neutral200",background:"neutral150",paddingLeft:"1px",justifyContent:"center",alignItems:"center",children:e.jsx(dt,{variant:"sigma",textColor:"neutral600",children:t})}),dt=J(S)`
  font-size: 0.9rem;
  line-height: 0.9rem;
`,ut=({content:t})=>e.jsx(ie.Group,{children:t.map((n,s)=>{const a=`${n.id}${s}`;if(s===3){const l=`+${t.length-3}`;return e.jsx(ce,{children:l},a)}return s>3?null:e.jsx(oe,{...n},a)})}),pt=({mainField:t,content:n})=>e.jsx(S,{maxWidth:"50rem",textColor:"neutral800",ellipsis:!0,children:le(n,t)}),mt=({mainField:t,content:n,rowId:s,name:a})=>{const{model:l}=Q(),{formatMessage:o}=k(),{notifyStatus:x}=Ze(),[d,r]=C.useState(!1),[f]=a.split("."),{data:m,isLoading:L}=tt({model:l,id:s,targetField:f},{skip:!d,refetchOnMountOrArgChange:!0}),T=Array.isArray(n)?n.length:n.count;return C.useEffect(()=>{m&&x(o({id:P("DynamicTable.relation-loaded"),defaultMessage:"Relations have been loaded"}))},[m,o,x]),e.jsxs(M.Root,{onOpenChange:j=>r(j),children:[e.jsx(M.Trigger,{onClick:j=>j.stopPropagation(),children:e.jsx(S,{style:{cursor:"pointer"},textColor:"neutral800",fontWeight:"regular",children:T>0?o({id:"content-manager.containers.list.items",defaultMessage:"{number} {number, plural, =0 {items} one {item} other {items}}"},{number:T}):"-"})}),e.jsxs(M.Content,{children:[L&&e.jsx(M.Item,{disabled:!0,children:e.jsx(Xe,{small:!0,children:o({id:P("ListViewTable.relation-loading"),defaultMessage:"Relations are loading"})})}),m?.results&&e.jsxs(e.Fragment,{children:[m.results.map(j=>e.jsx(M.Item,{disabled:!0,children:e.jsx(S,{maxWidth:"50rem",ellipsis:!0,children:le(j,t)})},j.documentId)),m?.pagination&&m?.pagination.total>10&&e.jsx(M.Item,{"aria-disabled":!0,"aria-label":o({id:P("ListViewTable.relation-more"),defaultMessage:"This relation contains more entities than displayed"}),children:e.jsx(S,{children:"â€¦"})})]})]})]})},gt=({content:t,mainField:n,attribute:s,rowId:a,name:l})=>{if(!ft(t,n,s))return e.jsx(S,{textColor:"neutral800",paddingLeft:s.type==="relation"?"1.6rem":0,paddingRight:s.type==="relation"?"1.6rem":0,children:"-"});switch(s.type){case"media":return s.multiple?e.jsx(ut,{content:t}):e.jsx(oe,{...t});case"relation":return de(s.relation)?e.jsx(pt,{mainField:n,content:t}):e.jsx(mt,{rowId:a,mainField:n,content:t,name:l});case"component":return s.repeatable?e.jsx(ot,{mainField:n,content:t}):e.jsx(lt,{mainField:n,content:t});case"string":return e.jsx(K,{description:t,children:e.jsx(S,{maxWidth:"30rem",ellipsis:!0,textColor:"neutral800",children:e.jsx(N,{type:s.type,value:t})})});default:return e.jsx(S,{maxWidth:"30rem",ellipsis:!0,textColor:"neutral800",children:e.jsx(N,{type:s.type,value:t})})}},ft=(t,n,s)=>{if(s.type==="component"){if(s.repeatable||!n)return t?.length>0;const a=t?.[n.name];return n.name==="id"&&![void 0,null].includes(a)?!0:!z(a)}return s.type==="relation"?de(s.relation)?!z(t):Array.isArray(t)?t.length>0:t?.count>0:["integer","decimal","float","number"].includes(s.type)?typeof t=="number":s.type==="boolean"?t!==null:!z(t)},de=t=>["oneToOne","manyToOne","oneToOneMorph"].includes(t),ht=t=>{const n=st(o=>o.admin_app.permissions.contentManager?.collectionTypesConfigurations??[]),[{query:s}]=D(),{formatMessage:a}=k(),{allowedActions:{canConfigureView:l}}=te(n);return e.jsxs(W.Root,{children:[e.jsx(W.Trigger,{children:e.jsx(Oe,{label:a({id:"components.ViewSettings.tooltip",defaultMessage:"View Settings"}),children:e.jsx(Be,{})})}),e.jsx(W.Content,{side:"bottom",align:"end",sideOffset:4,children:e.jsxs(v,{alignItems:"stretch",direction:"column",padding:3,gap:3,children:[l?e.jsx(De,{size:"S",startIcon:e.jsx(He,{}),variant:"secondary",tag:$e,to:{pathname:"configurations/list",search:s.plugins?U.stringify({plugins:s.plugins},{encode:!1}):""},children:a({id:"app.links.configure-view",defaultMessage:"Configure the view"})}):null,e.jsx(xt,{...t})]})})]})},xt=({headers:t=[],resetHeaders:n,setHeaders:s})=>{const{trackUsage:a}=_(),{formatMessage:l,locale:o}=k(),{schema:x,model:d}=Q(),{list:r}=ee(d),f=ae(o,{sensitivity:"base"}),m=x?.attributes??{},L=Object.keys(m).filter(u=>qe(m[u])).map(u=>({name:u,label:r.metadatas[u]?.label??""})).sort((u,p)=>f.compare(u.label,p.label)),T=u=>{a("didChangeDisplayedFields");const p=t.includes(u)?t.filter(R=>R!==u):[...t,u];s(p)},j=()=>{n()};return e.jsxs(v,{tag:"fieldset",direction:"column",alignItems:"stretch",gap:3,borderWidth:0,maxHeight:"240px",overflow:"scroll",children:[e.jsxs(v,{justifyContent:"space-between",children:[e.jsx(S,{tag:"legend",variant:"pi",fontWeight:"bold",children:l({id:"containers.list.displayedFields",defaultMessage:"Displayed fields"})}),e.jsx(Qe,{onClick:j,children:l({id:"app.components.Button.reset",defaultMessage:"Reset"})})]}),e.jsx(v,{direction:"column",alignItems:"stretch",children:L.map(u=>{const p=t.includes(u.name);return e.jsx(v,{wrap:"wrap",gap:2,background:p?"primary100":"transparent",hasRadius:!0,padding:2,children:e.jsx(Ge,{onCheckedChange:()=>T(u.name),checked:p,name:u.name,children:e.jsx(S,{fontSize:1,children:u.label})})},u.name)})})]})},{INJECT_COLUMN_IN_TABLE:jt}=ye,yt=J(q.Header)`
  overflow-wrap: anywhere;
`,bt=()=>{const{trackUsage:t}=_(),n=ue(),{formatMessage:s}=k(),{toggleNotification:a}=pe(),{_unstableFormatAPIError:l}=me(P),{collectionType:o,model:x,schema:d}=Q(),{list:r}=ee(x),[f,m]=C.useState([]),L=re(r.layout);C.useEffect(()=>{ge(L,r.layout)||m(r.layout)},[r.layout,L]);const T=i=>{m(Ue(i,d.attributes,r.metadatas))},[{query:j}]=D({page:"1",pageSize:r.settings.pageSize.toString(),sort:r.settings.defaultSortBy?`${r.settings.defaultSortBy}:${r.settings.defaultSortOrder}`:""}),u=C.useMemo(()=>fe(j),[j]),{data:p,error:R,isFetching:B}=he({model:x,params:u});C.useEffect(()=>{R&&a({type:"danger",message:l(R)})},[R,l,a]);const{results:O=[],pagination:I}=p??{};C.useEffect(()=>{I&&I.pageCount>0&&I.page>I.pageCount&&n({search:U.stringify({...j,page:I.pageCount})},{replace:!0})},[I,s,j,n]);const{canCreate:$}=xe("ListViewPage",({canCreate:i})=>({canCreate:i})),g=je("ListViewPage",({runHookWaterfall:i})=>i),F=C.useMemo(()=>{const A=g(jt,{displayedHeaders:f,layout:r}).displayedHeaders.map(c=>{const E=typeof c.label=="string"?{id:`content-manager.content-types.${x}.${c.name}`,defaultMessage:c.label}:c.label;return{...c,label:s(E),name:`${c.name}${c.mainField?.name?`.${c.mainField.name}`:""}`}});return d?.options?.draftAndPublish&&A.push({attribute:{type:"custom"},name:"status",label:s({id:P("containers.list.table-headers.status"),defaultMessage:"status"}),searchable:!1,sortable:!1}),A},[f,s,r,g,d?.options?.draftAndPublish,x]);if(B)return e.jsx(w.Loading,{});if(R)return e.jsx(w.Error,{});const y=d?.info.displayName?s({id:d.info.displayName,defaultMessage:d.info.displayName}):s({id:"content-manager.containers.untitled",defaultMessage:"Untitled"}),h=i=>()=>{t("willEditEntryFromList"),n({pathname:i.toString(),search:U.stringify({plugins:j.plugins})})};return e.jsxs(w.Main,{children:[e.jsx(w.Title,{children:`${y}`}),e.jsx(yt,{primaryAction:$?e.jsx(X,{}):null,subtitle:s({id:P("pages.ListView.header-subtitle"),defaultMessage:"{number, plural, =0 {# entries} one {# entry} other {# entries}} found"},{number:I?.total}),title:y,navigationAction:e.jsx(be,{})}),e.jsx(q.Action,{endActions:e.jsxs(e.Fragment,{children:[e.jsx(Se,{area:"listView.actions"}),e.jsx(ht,{setHeaders:T,resetHeaders:()=>m(r.layout),headers:f.map(i=>i.name)})]}),startActions:e.jsxs(e.Fragment,{children:[r.settings.searchable&&e.jsx(Ce,{disabled:O.length===0,label:s({id:"app.component.search.label",defaultMessage:"Search for {target}"},{target:y}),placeholder:s({id:"global.search",defaultMessage:"Search"}),trackedEvent:"didSearch"}),r.settings.filterable&&d?e.jsx(it,{disabled:O.length===0,schema:d}):null]})}),e.jsx(q.Content,{children:e.jsxs(v,{gap:4,direction:"column",alignItems:"stretch",children:[e.jsxs(b.Root,{rows:O,headers:F,isLoading:B,children:[e.jsx(St,{}),e.jsxs(b.Content,{children:[e.jsxs(b.Head,{children:[e.jsx(b.HeaderCheckboxCell,{}),F.map(i=>e.jsx(b.HeaderCell,{...i},i.name))]}),e.jsx(b.Loading,{}),e.jsx(b.Empty,{action:$?e.jsx(X,{variant:"secondary"}):null}),e.jsx(b.Body,{children:O.map(i=>e.jsxs(b.Row,{cursor:"pointer",onClick:h(i.documentId),children:[e.jsx(b.CheckboxCell,{id:i.id}),F.map(({cellFormatter:A,...c})=>{if(c.name==="status"){const{status:E}=i;return e.jsx(b.Cell,{children:e.jsx(Le,{status:E,maxWidth:"min-content"})},c.name)}return["createdBy","updatedBy"].includes(c.name.split(".")[0])?e.jsx(b.Cell,{children:e.jsx(S,{textColor:"neutral800",children:i[c.name.split(".")[0]]?G(i[c.name.split(".")[0]]):"-"})},c.name):typeof A=="function"?e.jsx(b.Cell,{children:A(i,c,{collectionType:o,model:x})},c.name):e.jsx(b.Cell,{children:e.jsx(gt,{content:i[c.name.split(".")[0]],rowId:i.documentId,...c})},c.name)}),e.jsx(Ct,{onClick:A=>A.stopPropagation(),children:e.jsx(Te,{document:i})})]},i.id))})]})]}),e.jsxs(V.Root,{...I,onPageSizeChange:()=>t("willChangeNumberOfEntriesPerPage"),children:[e.jsx(V.PageSize,{}),e.jsx(V.Links,{})]})]})})]})},Ct=J(b.Cell)`
  display: flex;
  justify-content: flex-end;
`,St=()=>{const t=Ne("TableActionsBar",l=>l.selectRow),[{query:n}]=D(),s=n?.plugins?.i18n?.locale,a=re(s);return C.useEffect(()=>{a!==s&&t([])},[t,a,s]),e.jsx(b.ActionBar,{children:e.jsx(_e,{})})},X=({variant:t})=>{const{formatMessage:n}=k(),{trackUsage:s}=_(),[{query:a}]=D();return e.jsx(Fe,{variant:t,tag:Ae,onClick:()=>{s("willCreateEntry",{status:"draft"})},startIcon:e.jsx(Ee,{}),style:{textDecoration:"none"},to:{pathname:"create",search:U.stringify({plugins:a.plugins})},minWidth:"max-content",marginLeft:2,children:n({id:P("HeaderLayout.button.label-add-entry"),defaultMessage:"Create new entry"})})},Mt=()=>{const{slug:t=""}=Ie(),{permissions:n=[],isLoading:s,error:a}=te(Me.map(l=>({action:l,subject:t})));return s?e.jsx(w.Loading,{}):a||!t?e.jsx(w.Error,{}):e.jsx(w.Protect,{permissions:n,children:({permissions:l})=>e.jsx(Re,{permissions:l,children:e.jsx(bt,{})})})};export{bt as ListViewPage,Mt as ProtectedListViewPage};
